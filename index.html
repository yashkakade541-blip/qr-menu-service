<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Menu - Digital Restaurant Ordering Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .smooth-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .menu-item-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .menu-item-card:hover {
            transform: scale(1.03);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .stat-card {
            background: white;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateX(4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.025em;
        }
    </style>
</head>
<body>

    <!-- Super Admin Hide Logic -->
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const isSuperAdmin = urlParams.get('super') === 'true';
        
        if (!isSuperAdmin) {
            document.addEventListener('DOMContentLoaded', function() {
                const superTab = document.getElementById('superLoginTab');
                const superForm = document.getElementById('superLoginForm');
                if (superTab) superTab.style.display = 'none';
                if (superForm) superForm.style.display = 'none';
                
                const adminTab = document.getElementById('adminLoginTab');
                if (adminTab) {
                    adminTab.classList.add('bg-purple-600', 'text-white');
                    adminTab.classList.remove('bg-gray-200', 'text-gray-700');
                    document.getElementById('adminLoginForm').classList.remove('hidden');
                }
            });
        }
    </script>

    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-card rounded-3xl shadow-2xl p-10 max-w-md w-full fade-in">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
                    QR Menu Platform
                </h1>
                <p class="text-gray-600 font-medium">Digital Restaurant Ordering System</p>
            </div>
            
            <div class="flex gap-2 mb-8">
                <button onclick="showLoginTab('super')" id="superLoginTab" class="flex-1 py-3 rounded-xl font-semibold smooth-transition bg-purple-600 text-white shadow-lg">
                    Super Admin
                </button>
                <button onclick="showLoginTab('admin')" id="adminLoginTab" class="flex-1 py-3 rounded-xl font-semibold smooth-transition bg-gray-100 text-gray-700 hover:bg-gray-200">
                    Restaurant Admin
                </button>
            </div>

            <!-- Super Admin Login -->
            <form id="superLoginForm" onsubmit="handleSuperAdminLogin(event)" class="space-y-5">
                <div>
                    <label class="block font-semibold mb-2 text-gray-700">Email Address</label>
                    <input type="email" id="superEmail" value="owner@qrmenu.com" required 
                           class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 smooth-transition">
                </div>
                <div>
                    <label class="block font-semibold mb-2 text-gray-700">Password</label>
                    <input type="password" id="superPassword" value="Admin@296220" required 
                           class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 smooth-transition">
                </div>
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-xl font-semibold shadow-lg">
                    Sign In
                </button>
            </form>

            <!-- Restaurant Admin Login -->
            <form id="adminLoginForm" onsubmit="handleAdminLogin(event)" class="space-y-5 hidden">
                <div>
                    <label class="block font-semibold mb-2 text-gray-700">Email Address</label>
                    <input type="email" id="adminEmail" required 
                           class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 smooth-transition">
                </div>
                <div>
                    <label class="block font-semibold mb-2 text-gray-700">Password</label>
                    <input type="password" id="adminPassword" required 
                           class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 smooth-transition">
                </div>
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-xl font-semibold shadow-lg">
                    Sign In
                </button>
            </form>

            <div class="mt-8 text-center">
                <a href="javascript:void(0)" onclick="showCustomerView()" class="text-purple-600 hover:text-purple-700 font-semibold smooth-transition">
                    Continue as Customer
                </a>
            </div>
        </div>
    </div>

    <!-- Super Admin Dashboard -->
    <div id="superAdminDashboard" class="hidden min-h-screen bg-gray-50">
        <nav class="bg-white shadow-md border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                        Super Admin Portal
                    </h1>
                    <div class="flex items-center gap-4">
                        <span class="text-gray-700 font-medium">
                            <span id="superAdminName" class="font-bold"></span>
                        </span>
                        <button onclick="logout()" class="bg-red-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-red-700 smooth-transition">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #8B5CF6;">
                    <div class="text-3xl font-bold text-purple-600" id="totalRestaurants">0</div>
                    <div class="text-gray-600 font-medium mt-1">Total Restaurants</div>
                </div>
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #10B981;">
                    <div class="text-3xl font-bold text-green-600">‚Çπ<span id="totalRevenue">0</span></div>
                    <div class="text-gray-600 font-medium mt-1">Monthly Revenue</div>
                </div>
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #3B82F6;">
                    <div class="text-3xl font-bold text-blue-600" id="activeRestaurants">0</div>
                    <div class="text-gray-600 font-medium mt-1">Active Accounts</div>
                </div>
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #F59E0B;">
                    <div class="text-3xl font-bold text-orange-600" id="totalOrders">0</div>
                    <div class="text-gray-600 font-medium mt-1">Total Orders</div>
                </div>
            </div>

            <!-- Add Restaurant -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800">Restaurants</h2>
                    <button onclick="showAddRestaurantModal()" class="bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 smooth-transition shadow-md">
                        Add New Restaurant
                    </button>
                </div>
            </div>

            <!-- Restaurants List -->
            <div id="restaurantsList" class="space-y-4"></div>
        </div>
    </div>

    <!-- Restaurant Admin Dashboard -->
    <div id="restaurantAdminDashboard" class="hidden min-h-screen bg-gray-50">
        <nav class="bg-white shadow-md border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex justify-between items-center h-16">
                    <h1 class="text-2xl font-bold text-gray-800">
                        <span id="restaurantName"></span>
                    </h1>
                    <div class="flex items-center gap-4">
                        <span class="text-gray-700 font-medium">
                            <span id="adminName" class="font-bold"></span>
                        </span>
                        <button onclick="logout()" class="bg-red-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-red-700 smooth-transition">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-6 py-8">
            <!-- Stats -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #3B82F6;">
                    <div class="text-3xl font-bold text-blue-600" id="todayOrders">0</div>
                    <div class="text-gray-600 font-medium mt-1">Today's Orders</div>
                </div>
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #10B981;">
                    <div class="text-3xl font-bold text-green-600">‚Çπ<span id="todayEarnings">0</span></div>
                    <div class="text-gray-600 font-medium mt-1">Today's Earnings</div>
                </div>
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #F59E0B;">
                    <div class="text-3xl font-bold text-orange-600" id="pendingOrders">0</div>
                    <div class="text-gray-600 font-medium mt-1">Pending Orders</div>
                </div>
                <div class="stat-card rounded-xl shadow-md p-6" style="border-color: #8B5CF6;">
                    <div class="text-3xl font-bold text-purple-600" id="totalMenuItems">0</div>
                    <div class="text-gray-600 font-medium mt-1">Menu Items</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex gap-3 mb-8 bg-white p-2 rounded-xl shadow-md">
                <button onclick="showAdminTab('orders')" id="ordersTab" class="flex-1 px-6 py-3 rounded-lg font-semibold smooth-transition bg-purple-600 text-white">
                    Orders
                </button>
                <button onclick="showAdminTab('menu')" id="menuTab" class="flex-1 px-6 py-3 rounded-lg font-semibold smooth-transition bg-gray-100 text-gray-700 hover:bg-gray-200">
                    Menu
                </button>
                <button onclick="showAdminTab('qr')" id="qrTab" class="flex-1 px-6 py-3 rounded-lg font-semibold smooth-transition bg-gray-100 text-gray-700 hover:bg-gray-200">
                    QR Codes
                </button>
            </div>

            <!-- Content areas -->
            <div id="ordersTabContent" class="tab-content">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">Orders Management</h3>
                    <div id="ordersList" class="space-y-4"></div>
                </div>
            </div>

            <div id="menuTabContent" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">Menu Management</h3>
                        <button onclick="showAddMenuItemModal()" class="bg-green-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-green-700 smooth-transition shadow-md">
                            Add Menu Item
                        </button>
                    </div>
                    <div id="menuItemsList" class="space-y-3"></div>
                </div>
            </div>

            <div id="qrTabContent" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">QR Codes for Tables</h3>
                    <div class="mb-8 flex items-end gap-4">
                        <div class="flex-1">
                            <label class="block font-semibold mb-2 text-gray-700">Number of Tables</label>
                            <input type="number" id="tablesCount" min="1" max="50" value="10" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 smooth-transition">
                        </div>
                        <button onclick="generateQRCodes()" class="bg-purple-600 text-white px-8 py-3 rounded-xl font-semibold hover:bg-purple-700 smooth-transition shadow-md">
                            Generate QR Codes
                        </button>
                    </div>
                    <div id="qrCodesContainer" class="grid md:grid-cols-3 gap-6"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer View -->
    <div id="customerView" class="hidden">
        <div id="selectRestaurant" class="min-h-screen flex items-center justify-center p-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="glass-card rounded-3xl shadow-2xl p-10 max-w-md w-full fade-in">
                <h2 class="text-3xl font-bold text-center mb-8 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
                    Select Restaurant
                </h2>
                <div id="restaurantsListCustomer" class="space-y-3"></div>
                <div class="mt-8 text-center">
                    <button onclick="showLoginPage()" class="text-purple-600 hover:text-purple-700 font-semibold smooth-transition">
                        Back to Login
                    </button>
                </div>
            </div>
        </div>

        <div id="menuView" class="hidden bg-gray-50 min-h-screen">
            <nav class="bg-white shadow-md sticky top-0 z-50 border-b border-gray-200">
                <div class="max-w-4xl mx-auto px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800" id="customerRestaurantName"></h1>
                            <p class="text-sm text-gray-600 font-medium">Table <span id="customerTableNumber" class="font-bold"></span></p>
                        </div>
                        <button onclick="showCart()" id="cartButton" class="bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-purple-700 smooth-transition shadow-md">
                            Cart (<span id="cartCount">0</span>)
                        </button>
                    </div>
                </div>
            </nav>

            <div class="max-w-4xl mx-auto px-6 py-8">
                <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                    <label class="block font-semibold mb-3 text-gray-700">Your Name</label>
                    <input type="text" id="customerNameInput" placeholder="Enter your name" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 smooth-transition font-medium">
                </div>

                <div id="menuItemsCustomer" class="grid md:grid-cols-2 gap-6"></div>
            </div>
        </div>
    </div>

    <!-- Modals Container -->
    <div id="modalsContainer"></div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://eawtxegerinqfpdbkkdp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhd3R4ZWdlcmlucWZwZGJra2RwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3OTY3OTEsImV4cCI6MjA4MzM3Mjc5MX0.TeMJhtdO-WIqGYuq4u7WjK8Bmnhu_1pYlRaIb346PgA';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let currentRestaurant = null;
        let cart = [];

        // Login Tab Switch
        function showLoginTab(type) {
            const superTab = document.getElementById('superLoginTab');
            const adminTab = document.getElementById('adminLoginTab');
            const superForm = document.getElementById('superLoginForm');
            const adminForm = document.getElementById('adminLoginForm');

            if (type === 'super') {
                superTab.classList.add('bg-purple-600', 'text-white');
                superTab.classList.remove('bg-gray-100', 'text-gray-700');
                adminTab.classList.remove('bg-purple-600', 'text-white');
                adminTab.classList.add('bg-gray-100', 'text-gray-700');
                superForm.classList.remove('hidden');
                adminForm.classList.add('hidden');
            } else {
                adminTab.classList.add('bg-purple-600', 'text-white');
                adminTab.classList.remove('bg-gray-100', 'text-gray-700');
                superTab.classList.remove('bg-purple-600', 'text-white');
                superTab.classList.add('bg-gray-100', 'text-gray-700');
                adminForm.classList.remove('hidden');
                superForm.classList.add('hidden');
            }
        }

        // Super Admin Login
        async function handleSuperAdminLogin(e) {
            e.preventDefault();
            const email = document.getElementById('superEmail').value;
            const password = document.getElementById('superPassword').value;

            const { data, error } = await supabase
                .from('super_admins')
                .select('*')
                .eq('email', email)
                .eq('password', password)
                .single();

            if (error || !data) {
                alert('Invalid credentials!');
                return;
            }

            currentUser = { type: 'super', data: data };
            showSuperAdminDashboard();
        }

        // Restaurant Admin Login
        async function handleAdminLogin(e) {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            const { data, error } = await supabase
                .from('restaurant_admins')
                .select('*, restaurants(*)')
                .eq('email', email)
                .eq('password', password)
                .single();

            if (error || !data) {
                alert('Invalid credentials!');
                return;
            }

            currentUser = { type: 'admin', data: data };
            currentRestaurant = data.restaurants;
            showRestaurantAdminDashboard();
        }

        // Show Super Admin Dashboard
        async function showSuperAdminDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('superAdminDashboard').classList.remove('hidden');
            document.getElementById('superAdminName').textContent = currentUser.data.name;
            
            await loadSuperAdminStats();
            await loadRestaurantsList();
        }

        // Load Super Admin Stats
        async function loadSuperAdminStats() {
            const { data: restaurants } = await supabase
                .from('restaurants')
                .select('*');

            const { data: orders } = await supabase
                .from('orders')
                .select('*');

            const total = restaurants?.length || 0;
            const active = restaurants?.filter(r => r.status === 'active').length || 0;
            const revenue = restaurants?.reduce((sum, r) => sum + parseFloat(r.monthly_fee || 0), 0) || 0;
            const totalOrders = orders?.length || 0;

            document.getElementById('totalRestaurants').textContent = total;
            document.getElementById('activeRestaurants').textContent = active;
            document.getElementById('totalRevenue').textContent = revenue;
            document.getElementById('totalOrders').textContent = totalOrders;
        }

        // Load Restaurants List
        async function loadRestaurantsList() {
            const { data: restaurants } = await supabase
                .from('restaurants')
                .select('*, restaurant_admins(*)')
                .order('created_at', { ascending: false });

            const list = document.getElementById('restaurantsList');
            
            if (!restaurants || restaurants.length === 0) {
                list.innerHTML = '<div class="text-center py-12 text-gray-400"><p class="text-xl">No restaurants yet. Add your first client!</p></div>';
                return;
            }

            list.innerHTML = restaurants.map(r => `
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold mb-2">${r.name}</h3>
                            <p class="text-gray-600 mb-1">${r.address || 'N/A'}</p>
                            <p class="text-gray-600 mb-1">${r.phone || 'N/A'}</p>
                            <p class="text-gray-600 mb-1">${r.tables_count} Tables</p>
                            <p class="text-green-600 font-bold">‚Çπ${r.monthly_fee}/month</p>
                            <p class="text-sm text-gray-500 mt-2">Admin: ${r.restaurant_admins[0]?.email || 'N/A'}</p>
                        </div>
                        <div class="flex flex-col gap-2">
                            <span class="px-4 py-2 rounded-lg text-sm font-semibold ${r.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                ${r.status.toUpperCase()}
                            </span>
                            <button onclick="deleteRestaurant('${r.id}')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showAddRestaurantModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 modal-overlay flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-md w-full p-6">
                    <h3 class="text-2xl font-bold mb-4">Add New Restaurant</h3>
                    <form id="addRestaurantForm" onsubmit="handleAddRestaurant(event)" class="space-y-4">
                        <div>
                            <label class="block font-semibold mb-2">Restaurant Name</label>
                            <input type="text" id="restaurantNameInput" required class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Address</label>
                            <input type="text" id="restaurantAddress" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Phone</label>
                            <input type="tel" id="restaurantPhone" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Number of Tables</label>
                            <input type="number" id="restaurantTables" min="1" value="10" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Monthly Fee (‚Çπ)</label>
                            <input type="number" id="restaurantFee" value="999" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        
                        <hr class="my-4">
                        <h4 class="font-bold text-lg">Admin Credentials</h4>
                        <div>
                            <label class="block font-semibold mb-2">Admin Name</label>
                            <input type="text" id="adminNameInput" required class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Admin Email</label>
                            <input type="email" id="adminEmailInput" required class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Admin Password</label>
                            <input type="password" id="adminPasswordInput" required class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700">
                                Add Restaurant
                            </button>
                            <button type="button" onclick="this.closest('.modal-overlay').remove()" class="px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function handleAddRestaurant(e) {
            e.preventDefault();

            const restaurantData = {
                name: document.getElementById('restaurantNameInput').value,
                address: document.getElementById('restaurantAddress').value,
                phone: document.getElementById('restaurantPhone').value,
                tables_count: parseInt(document.getElementById('restaurantTables').value),
                monthly_fee: parseFloat(document.getElementById('restaurantFee').value),
                super_admin_id: currentUser.data.id
            };

            const { data: restaurant, error: restError } = await supabase
                .from('restaurants')
                .insert([restaurantData])
                .select()
                .single();

            if (restError) {
                alert('Error adding restaurant: ' + restError.message);
                return;
            }

            const adminData = {
                restaurant_id: restaurant.id,
                name: document.getElementById('adminNameInput').value,
                email: document.getElementById('adminEmailInput').value,
                password: document.getElementById('adminPasswordInput').value
            };

            const { error: adminError } = await supabase
                .from('restaurant_admins')
                .insert([adminData]);

            if (adminError) {
                alert('Error creating admin: ' + adminError.message);
                return;
            }

            alert('Restaurant added successfully!');
            document.querySelector('.modal-overlay').remove();
            loadSuperAdminStats();
            loadRestaurantsList();
        }

        async function deleteRestaurant(id) {
            if (!confirm('Are you sure? This will delete all data for this restaurant.')) return;

            const { error } = await supabase
                .from('restaurants')
                .delete()
                .eq('id', id);

            if (error) {
                alert('Error deleting restaurant: ' + error.message);
                return;
            }

            alert('Restaurant deleted!');
            loadSuperAdminStats();
            loadRestaurantsList();
        }

        async function showRestaurantAdminDashboard() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('restaurantAdminDashboard').classList.remove('hidden');
            document.getElementById('restaurantName').textContent = currentRestaurant.name;
            document.getElementById('adminName').textContent = currentUser.data.name;
            
            await loadRestaurantStats();
            showAdminTab('orders');
        }

        async function loadRestaurantStats() {
            const { data: orders } = await supabase
                .from('orders')
                .select('*')
                .eq('restaurant_id', currentRestaurant.id);

            const { data: menuItems } = await supabase
                .from('menu_items')
                .select('id')
                .eq('restaurant_id', currentRestaurant.id);

            const today = new Date().toISOString().split('T')[0];
            const todayOrders = orders?.filter(o => o.created_at.startsWith(today)) || [];
            
            document.getElementById('todayOrders').textContent = todayOrders.length;
            document.getElementById('todayEarnings').textContent = todayOrders.reduce((sum, o) => sum + parseFloat(o.total || 0), 0);
            document.getElementById('pendingOrders').textContent = orders?.filter(o => o.status === 'pending').length || 0;
            document.getElementById('totalMenuItems').textContent = menuItems?.length || 0;
        }

        function showAdminTab(tab) {
            ['ordersTab', 'menuTab', 'qrTab'].forEach(t => {
                document.getElementById(t).classList.remove('bg-purple-600', 'text-white');
                document.getElementById(t).classList.add('bg-gray-100', 'text-gray-700');
            });

            ['ordersTabContent', 'menuTabContent', 'qrTabContent'].forEach(c => {
                document.getElementById(c).classList.add('hidden');
            });

            document.getElementById(tab + 'Tab').classList.add('bg-purple-600', 'text-white');
            document.getElementById(tab + 'Tab').classList.remove('bg-gray-100', 'text-gray-700');
            document.getElementById(tab + 'TabContent').classList.remove('hidden');

            if (tab === 'orders') loadOrders();
            if (tab === 'menu') loadMenuItems();
        }

        async function loadOrders() {
            const { data: orders } = await supabase
                .from('orders')
                .select('*')
                .eq('restaurant_id', currentRestaurant.id)
                .order('created_at', { ascending: false });

            const list = document.getElementById('ordersList');

            if (!orders || orders.length === 0) {
                list.innerHTML = '<div class="text-center py-12 text-gray-400"><p class="text-xl">No orders yet</p></div>';
                return;
            }

            list.innerHTML = orders.map(order => {
                const items = JSON.parse(order.items);
                return `
                    <div class="border rounded-lg p-4 ${order.status === 'pending' ? 'bg-yellow-50' : 'bg-green-50'}">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <div class="font-bold text-lg">Table ${order.table_number} - ${order.customer_name}</div>
                                <div class="text-sm text-gray-600">${new Date(order.created_at).toLocaleString()}</div>
                            </div>
                            <div class="text-xl font-bold text-purple-600">‚Çπ${order.total}</div>
                        </div>
                        <div class="space-y-1 mb-3">
                            ${items.map(item => `
                                <div class="text-sm">${item.name} √ó ${item.quantity} = ‚Çπ${item.price * item.quantity}</div>
                            `).join('')}
                        </div>
                        ${order.status === 'pending' ? `
                            <button onclick="markOrderComplete('${order.id}')" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                                Mark Complete
                            </button>
                        ` : `
                            <span class="block text-center bg-green-100 text-green-800 py-2 rounded font-semibold">
                                Completed
                            </span>
                        `}
                    </div>
                `;
            }).join('');
        }

        async function markOrderComplete(orderId) {
            const { error } = await supabase
                .from('orders')
                .update({ status: 'completed' })
                .eq('id', orderId);

            if (error) {
                alert('Error: ' + error.message);
                return;
            }

            loadOrders();
            loadRestaurantStats();
        }

        async function loadMenuItems() {
            const { data: items } = await supabase
                .from('menu_items')
                .select('*')
                .eq('restaurant_id', currentRestaurant.id)
                .order('category');

            const list = document.getElementById('menuItemsList');

            if (!items || items.length === 0) {
                list.innerHTML = '<div class="text-center py-12 text-gray-400"><p class="text-xl">No menu items yet</p></div>';
                return;
            }

            list.innerHTML = items.map(item => `
                <div class="flex items-center justify-between bg-gray-50 p-4 rounded-lg">
                    <div class="flex items-center gap-4 flex-1">
                        <div class="text-4xl">${item.emoji || 'üçΩÔ∏è'}</div>
                        <div class="flex-1">
                            <div class="font-bold">${item.name}</div>
                            <div class="text-sm text-gray-600">${item.category}</div>
                        </div>
                        <div class="text-xl font-bold text-green-600">‚Çπ${item.price}</div>
                    </div>
                    <button onclick="deleteMenuItem('${item.id}')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 ml-4">
                        Delete
                    </button>
                </div>
            `).join('');
        }

        function showAddMenuItemModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 modal-overlay flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-md w-full p-6">
                    <h3 class="text-2xl font-bold mb-4">Add Menu Item</h3>
                    <form onsubmit="handleAddMenuItem(event)" class="space-y-4">
                        <div>
                            <label class="block font-semibold mb-2">Item Name</label>
                            <input type="text" id="menuItemName" required class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Category</label>
                            <select id="menuItemCategory" required class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                                <option value="">Select Category</option>
                                <option value="beverages">Beverages</option>
                                <option value="snacks">Snacks</option>
                                <option value="main">Main Course</option>
                                <option value="desserts">Desserts</option>
                            </select>
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Price (‚Çπ)</label>
                            <input type="number" id="menuItemPrice" required min="1" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2">Emoji</label>
                            <input type="text" id="menuItemEmoji" value="üçΩÔ∏è" maxlength="2" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 text-3xl text-center">
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700">
                                Add Item
                            </button>
                            <button type="button" onclick="this.closest('.modal-overlay').remove()" class="px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function handleAddMenuItem(e) {
            e.preventDefault();

            const itemData = {
                restaurant_id: currentRestaurant.id,
                name: document.getElementById('menuItemName').value,
                category: document.getElementById('menuItemCategory').value,
                price: parseFloat(document.getElementById('menuItemPrice').value),
                emoji: document.getElementById('menuItemEmoji').value
            };

            const { error } = await supabase
                .from('menu_items')
                .insert([itemData]);

            if (error) {
                alert('Error adding item: ' + error.message);
                return;
            }

            alert('Menu item added!');
            document.querySelector('.modal-overlay').remove();
            loadMenuItems();
            loadRestaurantStats();
        }

        async function deleteMenuItem(id) {
            if (!confirm('Delete this item?')) return;

            const { error } = await supabase
                .from('menu_items')
                .delete()
                .eq('id', id);

            if (error) {
                alert('Error: ' + error.message);
                return;
            }

            loadMenuItems();
            loadRestaurantStats();
        }

        function generateQRCodes() {
            const count = parseInt(document.getElementById('tablesCount').value);
            const container = document.getElementById('qrCodesContainer');
            const baseUrl = window.location.origin + window.location.pathname;

            let html = '';
            for (let i = 1; i <= count; i++) {
                const url = `${baseUrl}?restaurant=${currentRestaurant.id}&table=${i}`;
                const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
                
                html += `
                    <div class="border-2 border-gray-300 rounded-lg p-4 text-center">
                        <img src="${qrUrl}" alt="Table ${i} QR" class="mx-auto mb-2">
                        <div class="font-bold text-lg">Table ${i}</div>
                        <a href="${qrUrl}" download="table-${i}.png" class="text-sm text-purple-600 hover:underline">Download</a>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function showCustomerView() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('customerView').classList.remove('hidden');
            loadRestaurantsForCustomer();
        }

        async function loadRestaurantsForCustomer() {
            const { data: restaurants } = await supabase
                .from('restaurants')
                .select('*')
                .eq('status', 'active');

            const list = document.getElementById('restaurantsListCustomer');

            if (!restaurants || restaurants.length === 0) {
                list.innerHTML = '<div class="text-center py-6 text-gray-400">No restaurants available</div>';
                return;
            }

            list.innerHTML = restaurants.map(r => `
                <button onclick="selectRestaurantCustomer('${r.id}', '${r.name}')" class="w-full bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 text-left smooth-transition">
                    <div class="font-bold text-lg">${r.name}</div>
                    <div class="text-sm opacity-90">${r.address || ''}</div>
                </button>
            `).join('');
        }

        async function selectRestaurantCustomer(id, name) {
            currentRestaurant = { id: id, name: name };
            
            const table = prompt('Enter Table Number:', '1');
            if (!table) return;

            document.getElementById('customerTableNumber').textContent = table;
            document.getElementById('selectRestaurant').classList.add('hidden');
            document.getElementById('menuView').classList.remove('hidden');
            document.getElementById('customerRestaurantName').textContent = name;
            
            await loadMenuForCustomer(id);
        }

        async function loadMenuForCustomer(restaurantId) {
            const { data: items } = await supabase
                .from('menu_items')
                .select('*')
                .eq('restaurant_id', restaurantId)
                .eq('available', true);

            const container = document.getElementById('menuItemsCustomer');

            if (!items || items.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-400 col-span-2">No menu items available</div>';
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="bg-white rounded-lg shadow-lg p-4 menu-item-card">
                    <div class="text-5xl mb-2 text-center">${item.emoji || 'üçΩÔ∏è'}</div>
                    <h4 class="font-bold text-lg mb-1">${item.name}</h4>
                    <p class="text-gray-600 mb-3">‚Çπ${item.price}</p>
                    <button onclick='addToCart(${JSON.stringify(item)})' class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                        Add to Cart
                    </button>
                </div>
            `).join('');
        }

        function addToCart(item) {
            const existing = cart.find(i => i.id === item.id);
            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ ...item, quantity: 1 });
            }
            updateCartUI();
        }

        function updateCartUI() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        function showCart() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 modal-overlay flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bold">Your Cart</h3>
                        <button onclick="this.closest('.modal-overlay').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>
                    <div class="space-y-3">
                        ${cart.map(item => `
                            <div class="flex justify-between items-center border-b py-3">
                                <div class="flex-1">
                                    <div class="font-semibold">${item.emoji} ${item.name}</div>
                                    <div class="text-gray-600">‚Çπ${item.price} √ó ${item.quantity}</div>
                                </div>
                                <div class="font-bold">‚Çπ${item.price * item.quantity}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="border-t pt-4 mt-4">
                        <div class="flex justify-between text-xl font-bold mb-4">
                            <span>Total:</span>
                            <span>‚Çπ${total}</span>
                        </div>
                        <button onclick="placeOrder()" class="w-full bg-green-600 text-white py-4 rounded-lg text-lg font-bold hover:bg-green-700">
                            Place Order
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function placeOrder() {
            const customerName = document.getElementById('customerNameInput').value.trim();
            
            if (!customerName) {
                alert('Please enter your name');
                return;
            }

            if (cart.length === 0) {
                alert('Cart is empty');
                return;
            }

            const orderData = {
                restaurant_id: currentRestaurant.id,
                table_number: parseInt(document.getElementById('customerTableNumber').textContent),
                customer_name: customerName,
                items: JSON.stringify(cart),
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                status: 'pending'
            };

            const { error } = await supabase
                .from('orders')
                .insert([orderData]);

            if (error) {
                alert('Error placing order: ' + error.message);
                return;
            }

            alert('Order Placed Successfully!');
            cart = [];
            updateCartUI();
            document.querySelector('.modal-overlay').remove();
            document.getElementById('customerNameInput').value = '';
        }

        function showLoginPage() {
            document.getElementById('customerView').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }

        function logout() {
            currentUser = null;
            currentRestaurant = null;
            document.getElementById('superAdminDashboard').classList.add('hidden');
            document.getElementById('restaurantAdminDashboard').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }

        // Auto-load customer view from QR code
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const restaurantId = urlParams.get('restaurant');
            const tableNumber = urlParams.get('table');
            
            if (restaurantId && tableNumber) {
                showCustomerView();
                setTimeout(async () => {
                    const { data: restaurant } = await supabase
                        .from('restaurants')
                        .select('*')
                        .eq('id', restaurantId)
                        .single();
                    
                    if (restaurant) {
                        currentRestaurant = restaurant;
                        document.getElementById('customerTableNumber').textContent = tableNumber;
                        document.getElementById('selectRestaurant').classList.add('hidden');
                        document.getElementById('menuView').classList.remove('hidden');
                        document.getElementById('customerRestaurantName').textContent = restaurant.name;
                        await loadMenuForCustomer(restaurantId);
                    }
                }, 500);
            }
        });
    </script>

</body>
</html>
